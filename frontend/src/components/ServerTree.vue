<template>
  <div class="server-tree-container">
    <!-- Â∑•ÂÖ∑Ê†è -->
    <div class="toolbar">
      <!-- Âà†Èô§Ëøô‰∏§‰∏™ÊåâÈíÆ -->
      <!--
      <el-tooltip content="Ê∑ªÂä†ÊúçÂä°Âô®" placement="bottom" :effect="isDarkTheme ? 'dark' : 'light'">
        <el-button type="primary" class="toolbar-btn" @click="handleAddServer">
          <el-icon><Plus /></el-icon>
        </el-button>
      </el-tooltip>
      
      <el-tooltip content="Âà†Èô§ÊúçÂä°Âô®" placement="bottom" :effect="isDarkTheme ? 'dark' : 'light'">
        <el-button 
          type="danger" 
          class="toolbar-btn" 
          @click="handleDeleteServer" 
          :disabled="!selectedServer || !selectedServer.id"
        >
          <el-icon><Delete /></el-icon>
        </el-button>
      </el-tooltip>
      -->

      <el-tooltip content="ÊêúÁ¥¢ÊúçÂä°Âô®" placement="bottom" :effect="isDarkTheme ? 'dark' : 'light'">
        <el-input
          v-model="searchQuery"
          placeholder="ÊêúÁ¥¢ÊúçÂä°Âô®"
          class="search-input"
          clearable
          @input="handleSearch"
        >
          <template #prefix>
            <el-icon><Search /></el-icon>
          </template>
        </el-input>
      </el-tooltip>
    </div>

    <!-- Ê†ëÂΩ¢Êéß‰ª∂ÂÆπÂô® -->
    <div class="tree-container" @contextmenu.prevent="handleContainerRightClick">
      <div v-if="!serverTree.length" class="empty-state">
        <el-empty description="ÊöÇÊó†ÊúçÂä°Âô®">
          <el-button type="primary" @click="handleAddServer">Ê∑ªÂä†ÊúçÂä°Âô®</el-button>
        </el-empty>
      </div>
      <div v-else class="tree-content" :class="{'is-filtering': searchQuery}">
        <el-tree
          ref="treeRef"
          :data="serverTree"
          :props="defaultProps"
          :highlight-current="true"
          node-key="id"
          :expand-on-click-node="false"
          @node-click="handleNodeClick"
          @node-contextmenu="handleRightClick"
          :filter-node-method="filterNode"
        >
          <template #default="{ node, data }">
            <span 
              class="custom-tree-node" 
              :data-is-server="!!data.server.host"
              :data-is-folder="!data.server.host"
              :title="data.server.host 
                ? `ÂèåÂáªËøûÊé•Âà∞ ${data.server.name} (${data.server.host}:${data.server.port})` 
                : `ÂèåÂáªÂ±ïÂºÄ/ÊäòÂè† ${data.server.name}`"
              @dblclick.stop="handleNodeDblClick($event, data)"
            >
              <span class="node-icon">
                {{ !data.server.host ? 'üìÅ' : 'üñ•Ô∏è' }}
              </span>
              <span class="node-label">{{ node.label }}</span>
            </span>
          </template>
        </el-tree>
      </div>
    </div>

    <!-- Âè≥ÈîÆËèúÂçï -->
    <div v-show="showContextMenu" :style="contextMenuStyle" class="context-menu">
      <!-- Á©∫ÁôΩÂå∫ÂüüÁöÑÂè≥ÈîÆËèúÂçï -->
      <template v-if="contextMenuType === 'container'">
        <div class="context-menu-item" @click="handleAddRootFolder">
          <el-icon><Folder /></el-icon>
          <span>Ê∑ªÂä†Êñá‰ª∂Â§π</span>
        </div>
        <div class="context-menu-item" @click="handleAddRootServer">
          <el-icon><Plus /></el-icon>
          <span>Ê∑ªÂä†ÊúçÂä°Âô®</span>
        </div>
      </template>
      
      <!-- Êñá‰ª∂Â§πËäÇÁÇπÁöÑÂè≥ÈîÆËèúÂçï -->
      <template v-else-if="!contextMenuNode?.server.host">
        <div class="context-menu-item" @click="handleAddServer">
          <el-icon><Plus /></el-icon>
          <span>Ê∑ªÂä†ÊúçÂä°Âô®</span>
        </div>
        <div class="context-menu-item" @click="handleAddFolder">
          <el-icon><Folder /></el-icon>
          <span>Ê∑ªÂä†Êñá‰ª∂Â§π</span>
        </div>
        <div class="context-menu-item" @click="handleEdit">
          <el-icon><Edit /></el-icon>
          <span>ÁºñËæëÊñá‰ª∂Â§π</span>
        </div>
        <div class="context-menu-item" @click="handleDeleteServer">
          <el-icon><Delete /></el-icon>
          <span>Âà†Èô§Êñá‰ª∂Â§π</span>
        </div>
      </template>
      
      <!-- ÊúçÂä°Âô®ËäÇÁÇπÁöÑÂè≥ÈîÆËèúÂçï -->
      <template v-else>
        <div class="context-menu-item" @click="handleConnect">
          <el-icon><Connection /></el-icon>
          <span>ËøûÊé•</span>
        </div>
        <div class="context-menu-item" @click="handleEdit">
          <el-icon><Edit /></el-icon>
          <span>ÁºñËæë</span>
        </div>
        <div class="context-menu-item" @click="handleMove">
          <el-icon><Position /></el-icon>
          <span>ÁßªÂä®Âà∞</span>
        </div>
        <div class="context-menu-item" @click="handleDeleteServer">
          <el-icon><Delete /></el-icon>
          <span>Âà†Èô§</span>
        </div>
      </template>
    </div>

    <!-- Ê∑ªÂä†ÊúçÂä°Âô®ÂØπËØùÊ°Ü -->
    <el-dialog
      v-model="showAddDialog"
      title="Ê∑ªÂä†ÊúçÂä°Âô®"
      width="30%"
    >
      <el-form :model="newServer" label-width="80px">
        <el-form-item label="ÂêçÁß∞">
          <el-input v-model="newServer.name" placeholder="ËØ∑ËæìÂÖ•ÂêçÁß∞"></el-input>
        </el-form-item>
        <el-form-item label="Á±ªÂûã">
          <el-radio-group v-model="newServer.type">
            <el-radio :label="'folder'">Êñá‰ª∂Â§π</el-radio>
            <el-radio :label="'server'">ÊúçÂä°Âô®</el-radio>
          </el-radio-group>
        </el-form-item>
        <el-form-item label="‰∏äÁ∫ß" v-if="folders.length > 0">
          <el-select v-model="newServer.parentId" placeholder="ÈÄâÊã©‰∏äÁ∫ß">
            <el-option :value="0" label="Ê†πÁõÆÂΩï"></el-option>
            <el-option 
              v-for="folder in folders" 
              :key="folder.server.id" 
              :value="folder.server.id" 
              :label="folder.server.name">
            </el-option>
          </el-select>
        </el-form-item>
        <template v-if="newServer.type === 'server'">
          <el-form-item label="‰∏ªÊú∫">
            <el-input v-model="newServer.host" placeholder="ËØ∑ËæìÂÖ•‰∏ªÊú∫Âú∞ÂùÄ"></el-input>
          </el-form-item>
          <el-form-item label="Á´ØÂè£">
            <el-input-number v-model="newServer.port" :min="1" :max="65535"></el-input-number>
          </el-form-item>
          <el-form-item label="Áî®Êà∑Âêç">
            <el-input v-model="newServer.username" placeholder="ÂèØÈÄâ"></el-input>
          </el-form-item>
          <el-form-item label="ÂØÜÁ†Å">
            <el-input v-model="newServer.password" type="password" placeholder="ÂèØÈÄâ"></el-input>
          </el-form-item>
        </template>
      </el-form>
      <template #footer>
        <span class="dialog-footer">
          <el-button @click="showAddDialog = false">ÂèñÊ∂à</el-button>
          <el-button type="primary" @click="createServer">Á°ÆÂÆö</el-button>
        </span>
      </template>
    </el-dialog>

    <!-- Ê∑ªÂä†ÁºñËæëÊúçÂä°Âô®/Êñá‰ª∂Â§πÂØπËØùÊ°Ü -->
    <el-dialog
      v-model="showEditDialog"
      :title="editingServer.type === 'folder' ? 'ÁºñËæëÊñá‰ª∂Â§π' : 'ÁºñËæëÊúçÂä°Âô®'"
      width="30%"
    >
      <el-form :model="editingServer" label-width="80px">
        <el-form-item label="ÂêçÁß∞">
          <el-input v-model="editingServer.name" placeholder="ËØ∑ËæìÂÖ•ÂêçÁß∞"></el-input>
        </el-form-item>
        <template v-if="editingServer.type === 'server'">
          <el-form-item label="‰∏ªÊú∫">
            <el-input v-model="editingServer.host" placeholder="ËØ∑ËæìÂÖ•‰∏ªÊú∫Âú∞ÂùÄ"></el-input>
          </el-form-item>
          <el-form-item label="Á´ØÂè£">
            <el-input-number v-model="editingServer.port" :min="1" :max="65535"></el-input-number>
          </el-form-item>
          <el-form-item label="Áî®Êà∑Âêç">
            <el-input v-model="editingServer.username" placeholder="ÂèØÈÄâ"></el-input>
          </el-form-item>
          <el-form-item label="ÂØÜÁ†Å">
            <el-input v-model="editingServer.password" type="password" placeholder="ÂèØÈÄâ"></el-input>
          </el-form-item>
        </template>
      </el-form>
      <template #footer>
        <span class="dialog-footer">
          <el-button @click="showEditDialog = false">ÂèñÊ∂à</el-button>
          <el-button type="primary" @click="updateServer">Á°ÆÂÆö</el-button>
        </span>
      </template>
    </el-dialog>

    <!-- ÁßªÂä®ÊúçÂä°Âô®ÂØπËØùÊ°Ü -->
    <el-dialog
      v-model="showMoveDialog"
      title="ÁßªÂä®ÊúçÂä°Âô®"
      width="30%"
      :close-on-click-modal="false"
      :destroy-on-close="true"
    >
      <div v-if="moveTarget.id" class="move-dialog-content">
        <div class="move-source-info">
          <div class="source-label">ÁßªÂä®ÂØπË±°:</div>
          <div class="source-value">
            {{ contextMenuNode?.server.name }}
            <span class="source-type">{{ !contextMenuNode?.server.host ? '(Êñá‰ª∂Â§π)' : '(ÊúçÂä°Âô®)' }}</span>
          </div>
        </div>
        
        <el-form :model="moveTarget" label-width="80px" class="move-form">
          <el-form-item label="ÁõÆÊ†á‰ΩçÁΩÆ">
            <el-select 
              v-model="moveTarget.parentId" 
              placeholder="ÈÄâÊã©ÁõÆÊ†áÊñá‰ª∂Â§π" 
              class="full-width-select"
              :disabled="availableFolders.length === 0"
            >
              <el-option :value="0" label="Ê†πÁõÆÂΩï"></el-option>
              <el-option 
                v-for="folder in availableFolders" 
                :key="folder.server.id" 
                :value="folder.server.id" 
                :label="folder.server.name">
              </el-option>
            </el-select>
          </el-form-item>
        </el-form>
        
        <div v-if="availableFolders.length === 0" class="no-target-warning">
          <el-alert
            title="Ê≤°ÊúâÂèØÁî®ÁöÑÁõÆÊ†áÊñá‰ª∂Â§π"
            type="warning"
            :closable="false"
            show-icon
          >
            <p>ÂΩìÂâçÊó†Ê≥ïÁßªÂä®Ê≠§È°πÁõÆÔºåÂõ†‰∏∫Ê≤°ÊúâÂèØÁî®ÁöÑÁõÆÊ†áÊñá‰ª∂Â§π„ÄÇ</p>
          </el-alert>
        </div>
        
        <div v-if="isSameParent" class="move-warning">
          <el-alert
            title="ÁõÆÊ†á‰ΩçÁΩÆÊú™Êõ¥Êîπ"
            type="info"
            :closable="false"
            show-icon
          >
            <p>ÊÇ®ÈÄâÊã©ÁöÑÁõÆÊ†á‰ΩçÁΩÆ‰∏éÂΩìÂâç‰ΩçÁΩÆÁõ∏Âêå„ÄÇ</p>
          </el-alert>
        </div>
      </div>
      
      <template #footer>
        <span class="dialog-footer">
          <el-button @click="cancelMove">ÂèñÊ∂à</el-button>
          <el-button 
            type="primary" 
            @click="executeMove" 
            :disabled="isSameParent || availableFolders.length === 0"
            :loading="isMoving"
          >
            Á°ÆÂÆö
          </el-button>
        </span>
      </template>
    </el-dialog>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, computed, onUnmounted, nextTick } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { Plus, Delete, Search, Folder, Connection, Edit, Position } from '@element-plus/icons-vue'
import type { TreeInstance } from 'element-plus'

interface Server {
  id: number
  parent_id: number
  name: string
  host: string
  port: number
  username?: string
  password?: string
}

interface ServerTreeNode {
  server: Server
  children: ServerTreeNode[]
  type: 'folder' | 'server'
}

const emit = defineEmits(['select-server'])

const serverTree = ref<ServerTreeNode[]>([])
const selectedServer = ref<Server | null>(null)
const showAddDialog = ref(false)
const newServer = ref({
  name: '',
  type: 'server',
  parentId: 0,
  host: '',
  port: 23,
  username: '',
  password: ''
})

const defaultProps = {
  children: 'children',
  label: (data: ServerTreeNode) => data.server.name
}

// ËÆ°ÁÆóÊâÄÊúâÊñá‰ª∂Â§π
const folders = computed(() => {
  const result: ServerTreeNode[] = []
  const findFolders = (nodes: ServerTreeNode[]) => {
    for (const node of nodes) {
      if (!node.server.host) {
        result.push(node)
      }
      if (node.children && node.children.length > 0) {
        findFolders(node.children)
      }
    }
  }
  findFolders(serverTree.value)
  return result
})

// Ê∑ªÂä†‰∏ªÈ¢òÁä∂ÊÄÅÂèòÈáè
const isDarkTheme = ref(localStorage.getItem('theme') === 'dark')

// ÁõëÂê¨‰∏ªÈ¢òÂèòÂåñ
const updateTheme = () => {
  isDarkTheme.value = localStorage.getItem('theme') === 'dark'
  console.log('‰∏ªÈ¢òÂ∑≤Êõ¥Êñ∞:', isDarkTheme.value ? 'Ê∑±Ëâ≤' : 'ÊµÖËâ≤')
}

// Â§ÑÁêÜËá™ÂÆö‰πâ‰∏ªÈ¢òÂèòÂåñ‰∫ã‰ª∂
const handleThemeChange = (event: CustomEvent) => {
  isDarkTheme.value = event.detail.theme === 'dark'
  console.log('Êé•Êî∂Âà∞‰∏ªÈ¢òÂèòÂåñ:', isDarkTheme.value ? 'Ê∑±Ëâ≤' : 'ÊµÖËâ≤')
}

// Ëé∑ÂèñÊúçÂä°Âô®ÂàóË°®
const fetchServers = async () => {
  try {
    const response = await fetch('http://localhost:8080/servers/tree')
    const data = await response.json()
    serverTree.value = data
  } catch (error) {
    console.error('Failed to fetch servers:', error)
    ElMessage.error('Ëé∑ÂèñÊúçÂä°Âô®ÂàóË°®Â§±Ë¥•')
  }
}

// ÂàõÂª∫ÊúçÂä°Âô®
const createServer = async () => {
  try {
    const serverData = {
      parent_id: newServer.value.parentId,
      name: newServer.value.name,
      host: newServer.value.type === 'server' ? newServer.value.host : '',
      port: newServer.value.type === 'server' ? newServer.value.port : 0,
      username: newServer.value.username,
      password: newServer.value.password,
    }
    
    const response = await fetch('http://localhost:8080/servers', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(serverData)
    })
    
    if (response.ok) {
      ElMessage.success('Ê∑ªÂä†ÊàêÂäü')
      showAddDialog.value = false
      // ÈáçÁΩÆË°®Âçï
      newServer.value = {
        name: '',
        type: 'server',
        parentId: 0,
        host: '',
        port: 23,
        username: '',
        password: ''
      }
      // ÈáçÊñ∞Ëé∑ÂèñÊúçÂä°Âô®ÂàóË°®
      await fetchServers()
    } else {
      ElMessage.error('Ê∑ªÂä†Â§±Ë¥•')
    }
  } catch (error) {
    console.error('Failed to create server:', error)
    ElMessage.error('Ê∑ªÂä†ÊúçÂä°Âô®Â§±Ë¥•')
  }

}

// ÁºñËæëÂØπËØùÊ°ÜÁä∂ÊÄÅ
const showEditDialog = ref(false)
const editingServer = ref({
  id: 0,
  name: '',
  type: 'server',
  host: '',
  port: 23,
  username: '',
  password: '',
  parent_id: 0
})

// ÁßªÂä®ÂØπËØùÊ°ÜÁä∂ÊÄÅ
const showMoveDialog = ref(false)
const moveTarget = ref({
  id: 0,
  parentId: 0,
  originalParentId: 0 // Ê∑ªÂä†ÂéüÂßãÁà∂IDÁî®‰∫éÊØîËæÉ
})
const isMoving = ref(false) // Ê∑ªÂä†ÁßªÂä®‰∏≠Áä∂ÊÄÅÊ†áËÆ∞

// Ê†ëÂΩ¢ÁªÑ‰ª∂ÂºïÁî®
const treeRef = ref<TreeInstance>()

// Áä∂ÊÄÅÂèòÈáè
const searchQuery = ref('')
const showContextMenu = ref(false)
const contextMenuNode = ref<ServerTreeNode | null>(null)
const contextMenuPosition = ref({ x: 0, y: 0 })
const contextMenuType = ref<'node' | 'container'>('node') // Âè≥ÈîÆËèúÂçïÁ±ªÂûãÔºöËäÇÁÇπÊàñÂÆπÂô®

// ËÆ°ÁÆóÂ±ûÊÄß
const contextMenuStyle = computed(() => ({
  left: `${contextMenuPosition.value.x}px`,
  top: `${contextMenuPosition.value.y}px`
}))

const isSameParent = computed(() => {
  return moveTarget.value.parentId === moveTarget.value.originalParentId;
})

// ÊñπÊ≥ïÂÆö‰πâ
const handleSearch = (val: string) => {
  searchQuery.value = val
  treeRef.value?.filter(val)
}

const filterNode = (value: string, data: ServerTreeNode) => {
  if (!value) return true
  return data.server.name.toLowerCase().includes(value.toLowerCase())
}

const handleNodeClick = (node: ServerTreeNode) => {
  selectedServer.value = node.server
  // ‰ªÖÈÄâ‰∏≠Ôºå‰∏çËøûÊé•
  console.log('ÈÄâ‰∏≠ÊúçÂä°Âô®:', node.server)
}

// ‰øÆÊîπhandleNodeDblClickÂáΩÊï∞
const handleNodeDblClick = (event: Event, node: ServerTreeNode) => {
  // Ê∑ªÂä†Ë∞ÉËØï‰ø°ÊÅØ
  console.log('ÂèåÂáª‰∫ã‰ª∂Ëß¶Âèë', event, node);
  
  // ÈòªÊ≠¢‰∫ã‰ª∂ÂÜíÊ≥°ÔºåÈò≤Ê≠¢Ëß¶ÂèëÂÖ∂‰ªñÁÇπÂáª‰∫ã‰ª∂
  event.stopPropagation();
  
  // Â¶ÇÊûúÂèåÂáªÁöÑÊòØÊúçÂä°Âô®(‰∏çÊòØÊñá‰ª∂Â§π)ÔºåËß¶ÂèëËøûÊé•
  if (node.server && node.server.host) {
    console.log('ÂèåÂáªËøûÊé•Âà∞ÊúçÂä°Âô®:', node.server);
    
    // Ê∑ªÂä†Âä®ÁîªÊïàÊûú
    const target = event.currentTarget as HTMLElement;
    if (target) {
      target.classList.add('node-pulse');
      setTimeout(() => {
        target.classList.remove('node-pulse');
      }, 300);
    }
    
    // Ë∞ÉÁî®Áà∂ÁªÑ‰ª∂ÁöÑËøûÊé•ÊñπÊ≥ï
    try {
      console.log('ÂèëÂá∫select-server‰∫ã‰ª∂ÔºåÊï∞ÊçÆ:', node.server);
      emit('select-server', node.server);
      console.log('select-server‰∫ã‰ª∂Â∑≤ÂèëÂá∫');
    } catch (error) {
      console.error('ÂèëÂá∫select-server‰∫ã‰ª∂Â§±Ë¥•:', error);
    }
    
    // Ê∑ªÂä†ÊàêÂäüÊèêÁ§∫
    ElMessage.success(`Ê≠£Âú®ËøûÊé•Âà∞ ${node.server.name}`);
  } 
  // Â¶ÇÊûúÂèåÂáªÁöÑÊòØÊñá‰ª∂Â§πÔºåÂàôÂ±ïÂºÄ/ÊäòÂè†ËäÇÁÇπ
  else {
    console.log('ÂèåÂáªÂ±ïÂºÄ/ÊäòÂè†Êñá‰ª∂Â§π:', node.server.name);
    
    // Ê∑ªÂä†Âä®ÁîªÊïàÊûú
    const target = event.currentTarget as HTMLElement;
    if (target) {
      target.classList.add('folder-pulse');
      setTimeout(() => {
        target.classList.remove('folder-pulse');
      }, 300);
    }
    
    // Êü•ÊâæÂΩìÂâçËäÇÁÇπÁöÑÂ±ïÂºÄ/ÊäòÂè†ÂõæÊ†áÂπ∂Ê®°ÊãüÁÇπÂáª
    // Ëé∑ÂèñËäÇÁÇπÂÆπÂô®
    const treeNodeEl = (event.currentTarget as HTMLElement)?.closest('.el-tree-node');
    if (treeNodeEl) {
      // Êü•ÊâæÂ±ïÂºÄ/ÊäòÂè†ÂõæÊ†áÊåâÈíÆ
      const expandBtn = treeNodeEl.querySelector('.el-tree-node__expand-icon');
      if (expandBtn) {
        // Ê®°ÊãüÁÇπÂáªÂ±ïÂºÄ/ÊäòÂè†ÊåâÈíÆ
        (expandBtn as HTMLElement).click();
      }
    }
  }
}

// Â§ÑÁêÜÂÆπÂô®Âè≥ÈîÆÁÇπÂáª‰∫ã‰ª∂
const handleContainerRightClick = (event: MouseEvent) => {
  // Á°Æ‰øù‰∫ã‰ª∂ÂèëÁîüÂú®Á©∫ÁôΩÂå∫ÂüüÔºå‰∏çÊòØÊ†ëËäÇÁÇπ
  if ((event.target as HTMLElement).closest('.el-tree-node')) {
    return; // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÊ†ëËäÇÁÇπÔºå‰∏çÂ§ÑÁêÜ
  }
  
  event.preventDefault();
  contextMenuPosition.value = { x: event.clientX, y: event.clientY };
  contextMenuNode.value = null; // Ê∏ÖÁ©∫ËäÇÁÇπÂºïÁî®
  contextMenuType.value = 'container'; // ËÆæÁΩÆÂè≥ÈîÆËèúÂçïÁ±ªÂûã‰∏∫ÂÆπÂô®
  showContextMenu.value = true;
}

// Â§ÑÁêÜËäÇÁÇπÂè≥ÈîÆÁÇπÂáª‰∫ã‰ª∂
const handleRightClick = (event: MouseEvent, node: ServerTreeNode) => {
  event.preventDefault();
  contextMenuPosition.value = { x: event.clientX, y: event.clientY };
  contextMenuNode.value = node;
  contextMenuType.value = 'node'; // ËÆæÁΩÆÂè≥ÈîÆËèúÂçïÁ±ªÂûã‰∏∫ËäÇÁÇπ
  showContextMenu.value = true;
}

const handleAddServer = () => {
  showAddDialog.value = true
  newServer.value = {
    name: '',
    type: 'server',
    parentId: contextMenuNode.value?.server.id || 0,
    host: '',
    port: 23,
    username: '',
    password: ''
  }
}

const handleDeleteServer = async () => {
  if (!contextMenuNode.value) return;
  
  try {
    const isFolder = !contextMenuNode.value.server.host;
    const serverName = contextMenuNode.value.server.name;
    
    await ElMessageBox.confirm(
      `Á°ÆÂÆöË¶ÅÂà†Èô§${isFolder ? 'Êñá‰ª∂Â§π' : 'ÊúçÂä°Âô®'} "${serverName}" ÂêóÔºü${isFolder ? 'Êñá‰ª∂Â§πÂÜÖÁöÑÊâÄÊúâÊúçÂä°Âô®‰πüÂ∞ÜË¢´Âà†Èô§ÔºÅ' : ''}`, 
      'Ë≠¶Âëä', 
      {
        confirmButtonText: 'Á°ÆÂÆö',
        cancelButtonText: 'ÂèñÊ∂à',
        type: 'warning',
        confirmButtonClass: 'el-button--danger'
      }
    )
    
    const response = await fetch(`http://localhost:8080/servers/${contextMenuNode.value.server.id}`, {
      method: 'DELETE'
    })
    
    if (response.ok) {
      ElMessage.success('Âà†Èô§ÊàêÂäü')
      // Ê∏ÖÁ©∫ÈÄâ‰∏≠ÁöÑÊúçÂä°Âô®ÔºàÂ¶ÇÊûúË¢´Âà†Èô§ÁöÑÂ∞±ÊòØÂΩìÂâçÈÄâ‰∏≠ÁöÑÔºâ
      if (selectedServer.value && selectedServer.value.id === contextMenuNode.value.server.id) {
        selectedServer.value = null
      }
      // ÈáçÊñ∞Ëé∑ÂèñÊúçÂä°Âô®ÂàóË°®
      await fetchServers()
    } else {
      const errorText = await response.text()
      console.error('Âà†Èô§Â§±Ë¥•:', errorText)
      ElMessage.error(`Âà†Èô§Â§±Ë¥•: ${response.status} ${response.statusText}`)
    }
  } catch (error) {
    if (error !== 'cancel') {
      console.error('Failed to delete server:', error)
      ElMessage.error('Âà†Èô§Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÊàñÊúçÂä°Âô®Áä∂ÊÄÅ')
    }
  }
  
  showContextMenu.value = false
}

const handleAddFolder = () => {
  showAddDialog.value = true
  newServer.value = {
    name: '',
    type: 'folder',
    parentId: contextMenuNode.value?.server.id || 0,
    host: '',
    port: 0,
    username: '',
    password: ''
  }
}

const handleConnect = () => {
  if (contextMenuNode.value && contextMenuNode.value.server.host) {
    console.log('Âè≥ÈîÆËèúÂçïËøûÊé•Âà∞ÊúçÂä°Âô®:', contextMenuNode.value.server)
    emit('select-server', contextMenuNode.value.server)
  }
  showContextMenu.value = false
}

const handleEdit = () => {
  // ÂÆûÁé∞ÁºñËæëÊúçÂä°Âô®/Êñá‰ª∂Â§πÈÄªËæë
  if (!contextMenuNode.value) return;
  
  const server = contextMenuNode.value.server;
  editingServer.value = {
    id: server.id,
    name: server.name,
    type: server.host ? 'server' : 'folder',
    host: server.host || '',
    port: server.port || 23,
    username: server.username || '',
    password: server.password || '',
    parent_id: server.parent_id
  };
  
  showEditDialog.value = true;
  showContextMenu.value = false;
}

// Ëé∑ÂèñËäÇÁÇπÁöÑÊâÄÊúâÂ≠êËäÇÁÇπIDÔºàÂåÖÊã¨Ëá™Ë∫´Ôºâ
const getAllChildrenIds = (nodeId: number): number[] => {
  const ids: number[] = [nodeId];
  
  const findChildren = (nodes: ServerTreeNode[]) => {
    for (const node of nodes) {
      if (node.server.parent_id === nodeId) {
        ids.push(node.server.id);
        if (node.children && node.children.length > 0) {
          findChildren(node.children);
        }
      }
    }
  };
  
  // ‰ªéÊï¥‰∏™Ê†ë‰∏≠Êü•ÊâæÂ≠êËäÇÁÇπ
  findChildren(serverTree.value);
  return ids;
}

// Ëé∑ÂèñÂèØÈÄâÁöÑÁõÆÊ†áÊñá‰ª∂Â§πÔºàÊéíÈô§Ëá™Ë∫´ÂèäÂ≠êÊñá‰ª∂Â§πÔºâ
const availableFolders = computed(() => {
  if (!moveTarget.value.id) return folders.value;
  
  // Ëé∑ÂèñÂΩìÂâçËäÇÁÇπÁöÑÊâÄÊúâÂ≠êËäÇÁÇπID
  const excludeIds = getAllChildrenIds(moveTarget.value.id);
  
  // ËøáÊª§ÊéâËá™Ë∫´ÂèäÊâÄÊúâÂ≠êËäÇÁÇπ
  return folders.value.filter(folder => !excludeIds.includes(folder.server.id));
});

const handleMove = () => {
  if (!contextMenuNode.value) return;
  
  // Â¶ÇÊûúÊòØÊ†πÁõÆÂΩïÁöÑÊúçÂä°Âô®
  const isRootServer = contextMenuNode.value.server.parent_id === 0;
  
  // ËÆæÁΩÆÁßªÂä®ÁõÆÊ†á‰ø°ÊÅØ
  moveTarget.value = {
    id: contextMenuNode.value.server.id,
    parentId: isRootServer ? 0 : contextMenuNode.value.server.parent_id, // Á°Æ‰øùÊ†πÁõÆÂΩïÊòæÁ§∫Ê≠£Á°Æ
    originalParentId: contextMenuNode.value.server.parent_id
  };
  
  showMoveDialog.value = true;
  showContextMenu.value = false;
}

const cancelMove = () => {
  showMoveDialog.value = false;
  // Ê∏ÖÁ©∫ÁßªÂä®ÁõÆÊ†á‰ø°ÊÅØ
  setTimeout(() => {
    moveTarget.value = {
      id: 0,
      parentId: 0,
      originalParentId: 0
    };
  }, 200);
}

// Ê∑ªÂä†ÈÄöÁî®ÁöÑÊúçÂä°Âô®Êìç‰ΩúÂáΩÊï∞ - ÂàõÂª∫ÊúçÂä°Âô®Âπ∂Âà†Èô§ÊóßÊúçÂä°Âô®ÔºàÁî®‰∫éÁßªÂä®ÂíåÊõ¥Êñ∞Êìç‰ΩúÔºâ
const createAndReplaceServer = async (newServerData: any, oldServerId: number, successMessage: string) => {
  try {
    // 1. ÂàõÂª∫Êñ∞ÊúçÂä°Âô®
    console.log('ÂàõÂª∫Êñ∞ÊúçÂä°Âô®:', newServerData);
    const createResponse = await fetch('http://localhost:8080/servers', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      },
      body: JSON.stringify(newServerData)
    });
    
    if (!createResponse.ok) {
      const errorText = await createResponse.text();
      console.error('ÂàõÂª∫ÊúçÂä°Âô®Â§±Ë¥•:', errorText);
      ElMessage.error(`Êìç‰ΩúÂ§±Ë¥•: Êó†Ê≥ïÂàõÂª∫ÊúçÂä°Âô® (${createResponse.status})`);
      return false;
    }
    
    const createdServer = await createResponse.json();
    console.log('Êñ∞ÊúçÂä°Âô®ÂàõÂª∫ÊàêÂäü:', createdServer);
    
    // 2. Âà†Èô§ÂéüÂßãÊúçÂä°Âô®
    console.log(`Âà†Èô§ÂéüÂßãÊúçÂä°Âô®: ${oldServerId}`);
    const deleteResponse = await fetch(`http://localhost:8080/servers/${oldServerId}`, {
      method: 'DELETE'
    });
    
    if (!deleteResponse.ok) {
      const errorText = await deleteResponse.text();
      console.error('Âà†Èô§ÂéüÂßãÊúçÂä°Âô®Â§±Ë¥•:', errorText);
      ElMessage.warning('Ê≥®ÊÑè: ÊúçÂä°Âô®Â∑≤Âú®Êñ∞‰ΩçÁΩÆÂàõÂª∫Ôºå‰ΩÜÊó†Ê≥ïÂà†Èô§Âéü‰ΩçÁΩÆÁöÑÊúçÂä°Âô®ÔºåÂèØËÉΩ‰ºöÂá∫Áé∞ÈáçÂ§çÈ°π');
    } else {
      console.log('ÂéüÂßãÊúçÂä°Âô®Âà†Èô§ÊàêÂäü');
    }
    
    ElMessage.success(successMessage);
    return true;
  } catch (error) {
    console.error('Êìç‰ΩúÊúçÂä°Âô®ËøáÁ®ã‰∏≠ÂèëÁîüÈîôËØØ:', error);
    
    // Ê£ÄÊü•ÊòØÂê¶ÊòØÁΩëÁªúÈîôËØØ
    if (error instanceof TypeError && error.message.includes('network')) {
      ElMessage.error('ÁΩëÁªúËøûÊé•Â§±Ë¥•ÔºåËØ∑Á°Æ‰øùÂêéÁ´ØÊúçÂä°Ê≠£Âú®ËøêË°å');
    } else {
      ElMessage.error(`Êìç‰ΩúÂ§±Ë¥•: ${(error as Error).message || 'Êú™Áü•ÈîôËØØ'}`);
    }
    return false;
  }
}

// ‰øÆÊîπexecuteMoveÂáΩÊï∞‰ΩøÁî®Êñ∞ÁöÑÈÄöÁî®ÂáΩÊï∞
const executeMove = async () => {
  if (isSameParent.value) {
    ElMessage.info('‰ΩçÁΩÆÊú™Êõ¥ÊîπÔºåÊó†ÈúÄÁßªÂä®');
    return;
  }
  
  isMoving.value = true; // Ê†áËÆ∞ÂºÄÂßãÁßªÂä®
  
  try {
    // Ê£ÄÊü•ÊòØÂê¶ÈÄâÊã©‰∫ÜÁõÆÊ†áÊñá‰ª∂Â§π
    if (moveTarget.value.id === moveTarget.value.parentId) {
      ElMessage.warning('‰∏çËÉΩÁßªÂä®Âà∞Ëá™Ë∫´');
      isMoving.value = false;
      return;
    }
    
    // Ëé∑ÂèñÂΩìÂâçËäÇÁÇπÁöÑÊâÄÊúâÂ≠êËäÇÁÇπID
    const childrenIds = getAllChildrenIds(moveTarget.value.id);
    
    // Ê£ÄÊü•ÊòØÂê¶Â∞ùËØïÁßªÂä®Âà∞Â≠êÊñá‰ª∂Â§π‰∏≠ÔºàÈò≤Ê≠¢Âæ™ÁéØÂºïÁî®Ôºâ
    if (childrenIds.includes(moveTarget.value.parentId)) {
      ElMessage.error('‰∏çËÉΩÁßªÂä®Âà∞Ëá™Â∑±ÁöÑÂ≠êÊñá‰ª∂Â§π‰∏≠');
      isMoving.value = false;
      return;
    }
    
    // È¶ñÂÖàËé∑ÂèñÂΩìÂâçÊúçÂä°Âô®/Êñá‰ª∂Â§π‰ø°ÊÅØ
    console.log(`Ê≠£Âú®Ëé∑ÂèñÊúçÂä°Âô®ID: ${moveTarget.value.id} ÁöÑ‰ø°ÊÅØ`);
    const serverResponse = await fetch(`http://localhost:8080/servers/${moveTarget.value.id}`);
    
    if (!serverResponse.ok) {
      ElMessage.error(`Ëé∑ÂèñÊúçÂä°Âô®‰ø°ÊÅØÂ§±Ë¥•: ${serverResponse.status} ${serverResponse.statusText}`);
      isMoving.value = false;
      return;
    }
    
    const serverData = await serverResponse.json();
    console.log('Ëé∑ÂèñÂà∞ÊúçÂä°Âô®‰ø°ÊÅØ:', serverData);
    
    // ÂáÜÂ§áÊñ∞ÊúçÂä°Âô®Êï∞ÊçÆÔºà‰∏éÂéüÂßãÊúçÂä°Âô®Áõ∏ÂêåÔºå‰ΩÜparent_id‰∏çÂêåÔºâ
    const newServerData = {
      name: serverData.name,
      host: serverData.host || '',
      port: serverData.port || 0,
      username: serverData.username || '',
      password: serverData.password || '',
      parent_id: moveTarget.value.parentId
    };
    
    // ‰ΩøÁî®ÈÄöÁî®ÂáΩÊï∞ÂàõÂª∫Êñ∞ÊúçÂä°Âô®Âπ∂Âà†Èô§ÊóßÊúçÂä°Âô®
    const success = await createAndReplaceServer(newServerData, moveTarget.value.id, 'ÁßªÂä®ÊàêÂäü');
    
    if (success) {
      showMoveDialog.value = false;
      
      // ÈáçÊñ∞Ëé∑ÂèñÊúçÂä°Âô®ÂàóË°®
      await fetchServers();
      
      // Â¶ÇÊûúÈúÄË¶ÅÔºåÂèØ‰ª•Â±ïÂºÄÁõÆÊ†áÊñá‰ª∂Â§π
      if (moveTarget.value.parentId !== 0 && treeRef.value) {
        nextTick(() => {
          // Â∞ùËØïÂ±ïÂºÄÁõÆÊ†áÊñá‰ª∂Â§π
          try {
            const expandBtn = document.querySelector(`[data-key="${moveTarget.value.parentId}"] .el-tree-node__expand-icon`);
            if (expandBtn && !expandBtn.classList.contains('is-expanded')) {
              (expandBtn as HTMLElement).click();
            }
          } catch (err) {
            console.log('Â±ïÂºÄÁõÆÊ†áÊñá‰ª∂Â§πÂ§±Ë¥•', err);
          }
        });
      }
    }
  } catch (error) {
    console.error('ÁßªÂä®ÊúçÂä°Âô®ËøáÁ®ã‰∏≠ÂèëÁîüÈîôËØØ:', error);
    
    // Ê£ÄÊü•ÊòØÂê¶ÊòØÁΩëÁªúÈîôËØØ
    if (error instanceof TypeError && error.message.includes('network')) {
      ElMessage.error('ÁΩëÁªúËøûÊé•Â§±Ë¥•ÔºåËØ∑Á°Æ‰øùÂêéÁ´ØÊúçÂä°Ê≠£Âú®ËøêË°å');
    } else {
      ElMessage.error(`ÁßªÂä®ÊúçÂä°Âô®Â§±Ë¥•: ${(error as Error).message || 'Êú™Áü•ÈîôËØØ'}`);
    }
  } finally {
    isMoving.value = false; // Ê†áËÆ∞ÁßªÂä®ÁªìÊùü
  }
}

// Âú®Ê†πÁõÆÂΩïÊ∑ªÂä†Êñá‰ª∂Â§π
const handleAddRootFolder = () => {
  showAddDialog.value = true;
  newServer.value = {
    name: '',
    type: 'folder',
    parentId: 0, // ËÆæÁΩÆ‰∏∫Ê†πÁõÆÂΩï
    host: '',
    port: 0,
    username: '',
    password: ''
  };
  showContextMenu.value = false;
}

// Âú®Ê†πÁõÆÂΩïÊ∑ªÂä†ÊúçÂä°Âô®
const handleAddRootServer = () => {
  showAddDialog.value = true;
  newServer.value = {
    name: '',
    type: 'server',
    parentId: 0, // ËÆæÁΩÆ‰∏∫Ê†πÁõÆÂΩï
    host: '',
    port: 23,
    username: '',
    password: ''
  };
  showContextMenu.value = false;
}

// ÂÖ≥Èó≠Âè≥ÈîÆËèúÂçï
const closeContextMenu = () => {
  showContextMenu.value = false
}

// ‰øÆÊîπupdateServerÂáΩÊï∞‰ΩøÁî®Êñ∞ÁöÑÈÄöÁî®ÂáΩÊï∞
const updateServer = async () => {
  try {
    // È™åËØÅÂøÖÂ°´Â≠óÊÆµ
    if (!editingServer.value.name.trim()) {
      ElMessage.warning('ÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫')
      return
    }
    
    if (editingServer.value.type === 'server' && !editingServer.value.host.trim()) {
      ElMessage.warning('‰∏ªÊú∫Âú∞ÂùÄ‰∏çËÉΩ‰∏∫Á©∫')
      return
    }
    
    const serverData = {
      name: editingServer.value.name.trim(),
      parent_id: editingServer.value.parent_id,
      host: editingServer.value.type === 'server' ? editingServer.value.host.trim() : '',
      port: editingServer.value.type === 'server' ? editingServer.value.port : 0,
      username: editingServer.value.username || '',
      password: editingServer.value.password || '',
    }
    
    // ‰ΩøÁî®ÈÄöÁî®ÂáΩÊï∞ÂàõÂª∫Êñ∞ÊúçÂä°Âô®Âπ∂Âà†Èô§ÊóßÊúçÂä°Âô®
    const success = await createAndReplaceServer(serverData, editingServer.value.id, 'Êõ¥Êñ∞ÊàêÂäü');
    
    if (success) {
      showEditDialog.value = false;
      // ÈáçÊñ∞Ëé∑ÂèñÊúçÂä°Âô®ÂàóË°®
      await fetchServers();
    }
  } catch (error) {
    console.error('Failed to update server:', error)
    // Ê£ÄÊü•ÊòØÂê¶ÊòØÁΩëÁªúÈîôËØØ
    if (error instanceof TypeError && error.message.includes('network')) {
      ElMessage.error('ÁΩëÁªúËøûÊé•Â§±Ë¥•ÔºåËØ∑Á°Æ‰øùÂêéÁ´ØÊúçÂä°Ê≠£Âú®ËøêË°å');
    } else {
      ElMessage.error(`Êõ¥Êñ∞ÊúçÂä°Âô®Â§±Ë¥•: ${(error as Error).message || 'Êú™Áü•ÈîôËØØ'}`);
    }
  }
}

// ÁîüÂëΩÂë®ÊúüÈí©Â≠ê
onMounted(() => {
  document.addEventListener('click', closeContextMenu)
  fetchServers()
  
  // Ê∑ªÂä†‰∏ªÈ¢òÂèòÂåñÁõëÂê¨
  window.addEventListener('storage', updateTheme)
  window.addEventListener('theme-change', handleThemeChange as EventListener)
  
  // ÂàùÂßãÂåñ‰∏ªÈ¢ò
  updateTheme()
})

onUnmounted(() => {
  document.removeEventListener('click', closeContextMenu)
  
  // ÁßªÈô§‰∏ªÈ¢òÂèòÂåñÁõëÂê¨
  window.removeEventListener('storage', updateTheme)
  window.removeEventListener('theme-change', handleThemeChange as EventListener)
})
</script>

<style scoped>
.server-tree-container {
  display: flex;
  flex-direction: column;
  height: 100%;
  background: var(--bg-color);
  border-right: 1px solid var(--border-color);
}

.toolbar {
  padding: 12px;
  display: flex;
  gap: 8px;
  align-items: center;
  border-bottom: 1px solid var(--border-color);
  background: var(--panel-bg);
  backdrop-filter: blur(8px);
}

.toolbar-btn {
  padding: 8px;
  border-radius: 8px;
  transition: all 0.3s ease;
  background-color: var(--primary-color);
  color: white;
}

.toolbar-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  opacity: 0.9;
}

.search-input {
  flex: 1;
  max-width: 200px;
  
  :deep(.el-input__wrapper) {
    border-radius: 8px;
    background-color: var(--bg-color);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }
  
  :deep(.el-input__inner) {
    height: 32px;
    font-size: 14px;
    color: var(--text-color);
  }
}

.tree-container {
  flex: 1;
  overflow-y: auto;
  padding: 12px;
  background-color: var(--bg-color);
  position: relative;
  min-height: 100px; /* Á°Æ‰øùÂç≥‰ΩøÊ≤°ÊúâÂÜÖÂÆπÔºå‰πüÊúâË∂≥Â§üÁöÑÈ´òÂ∫¶ÂèØ‰ª•ÁÇπÂáª */
  cursor: context-menu; /* ÊèêÁ§∫Áî®Êà∑Ê≠§Âå∫ÂüüÂèØ‰ª•Âè≥ÈîÆ */
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* IE and Edge */
}

.tree-container::after {
  content: '';
  display: block;
  min-height: 100px; /* Á°Æ‰øùÊªöÂä®Âå∫ÂüüÂ∫ïÈÉ®‰πüÊúâÁ©∫Èó¥ÂèØÁÇπÂáª */
}

.tree-content {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 50px; /* Á°Æ‰øùÊ†ëÂΩ¢ÁªÑ‰ª∂ÊúâÊúÄÂ∞èÈ´òÂ∫¶ */
}

.custom-tree-node {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 4px 0;
  color: var(--text-color);
  cursor: pointer;
}

.custom-tree-node[data-is-server="true"] {
  cursor: pointer;
}

.custom-tree-node[data-is-folder="true"] {
  cursor: pointer;
  font-weight: 500;
}

.custom-tree-node[data-is-server="true"]:hover {
  text-decoration: underline;
  color: var(--primary-color);
}

.custom-tree-node[data-is-folder="true"]:hover {
  color: var(--primary-color);
  background-color: var(--hover-color);
  border-radius: 4px;
}

.custom-tree-node[data-is-server="true"]:active {
  transform: scale(0.98);
  transition: transform 0.1s ease;
}

.custom-tree-node[data-is-folder="true"]:active {
  transform: scale(0.98);
  transition: transform 0.1s ease;
  background-color: var(--active-color);
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(0.95); }
  100% { transform: scale(1); }
}

.node-pulse {
  animation: pulse 0.3s ease;
}

@keyframes folder-pulse {
  0% { transform: scale(1); }
  50% { transform: scale(0.98); background-color: var(--hover-color); }
  100% { transform: scale(1); }
}

.folder-pulse {
  animation: folder-pulse 0.3s ease;
}

.node-icon {
  font-size: 16px;
}

.node-label {
  font-size: 14px;
}

.context-menu {
  position: fixed;
  background: var(--bg-color);
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  padding: 4px;
  z-index: 1000;
  min-width: 160px;
  border: 1px solid var(--border-color);
}

.context-menu-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.2s ease;
  color: var(--text-color);
  
  &:hover {
    background: var(--hover-color);
    color: var(--primary-color);
  }
  
  .el-icon {
    font-size: 16px;
  }
}

/* Ëá™ÂÆö‰πâÊªöÂä®Êù°Ê†∑Âºè - ÂÆåÂÖ®ÈöêËóè */
::-webkit-scrollbar {
  width: 0;
  height: 0;
  display: none; /* ÂÖºÂÆπÊüê‰∫õÊµèËßàÂô® */
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: transparent;
}

::-webkit-scrollbar-thumb:hover {
  background: transparent;
}

/* Á°Æ‰øùFirefox‰πüÈöêËóèÊªöÂä®Êù° */
/* .tree-container {
  scrollbar-width: none; 
  -ms-overflow-style: none; 
} */

/* Element Plus Ê†ëÂΩ¢Êéß‰ª∂Ê†∑Âºè‰ºòÂåñ */
:deep(.el-tree) {
  background: transparent;
  color: var(--text-color);
  
  .el-tree-node__content {
    border-radius: 6px;
    height: 36px;
    color: var(--text-color);
    
    &:hover {
      background: var(--hover-color);
    }
    
    &.is-current {
      background: var(--active-color);
      color: var(--primary-color);
    }
  }
}

.move-dialog-content {
  padding: 10px 0;
}

.move-source-info {
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  padding: 8px 12px;
  background-color: var(--hover-color);
  border-radius: 4px;
}

.source-label {
  font-weight: bold;
  margin-right: 10px;
  color: var(--text-color);
}

.source-value {
  color: var(--primary-color);
  font-weight: 500;
}

.source-type {
  font-size: 12px;
  color: var(--text-color);
  opacity: 0.7;
  margin-left: 4px;
}

.move-form {
  margin-top: 15px;
}

.full-width-select {
  width: 100%;
}

.move-warning {
  margin-top: 15px;
}

.no-target-warning {
  margin-top: 15px;
  margin-bottom: 15px;
}
</style> 